```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASOBRICK FACTORY - Employee Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --brand-red: #e74c3c;
        }
        
        body {
            background-color: #f5f7fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .login-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3498db, #2c3e50);
        }
        
        .login-card {
            width: 400px;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        
        .login-logo {
            max-width: 200px;
            margin-bottom: 20px;
        }
        
        .dashboard-container {
            display: none;
            padding: 20px;
        }
        
        .header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-logo {
            height: 60px;
            margin-right: 20px;
        }
        
        .header-brand {
            display: flex;
            align-items: center;
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
            margin: 0;
        }
        
        .header-subtitle {
            font-size: 0.9rem;
            color: #bdc3c7;
            margin: 0;
        }
        
        .card {
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px 8px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
            border-color: #27ae60;
        }
        
        .btn-info {
            background-color: #17a2b8;
            border-color: #17a2b8;
        }
        
        .btn-info:hover {
            background-color: #138496;
            border-color: #117a8b;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            cursor: pointer;
        }
        
        .table th:hover {
            background-color: #e9ecef;
        }
        
        .sort-icon {
            margin-left: 5px;
            font-size: 0.8em;
        }
        
        .rating-badge {
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .rating-excellent {
            background-color: #d4edda;
            color: #155724;
        }
        
        .rating-good {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .rating-average {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .rating-poor {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .filter-section {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .work-entry {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .mechanical-entry {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .electrical-entry {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            min-width: 300px;
        }
        
        .brand-red-text {
            color: var(--brand-red);
            font-weight: 700;
        }
        
        .brand-gray-text {
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .work-record-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        
        .work-record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .work-record-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .work-record-date {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .work-record-rating {
            font-size: 1.2rem;
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .rating-positive {
            background-color: #d4edda;
            color: #155724;
        }
        
        .rating-neutral {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .rating-negative {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .work-record-note {
            margin-top: 10px;
        }
        
        .add-record-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .tab-content {
            min-height: 400px;
        }
        
        .records-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .records-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .records-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .records-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .records-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .record-tabs {
            margin-bottom: 15px;
        }
        
        .record-tab {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            cursor: pointer;
            display: inline-block;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .record-tab.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .record-count {
            background-color: #6c757d;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        .admin-only {
            display: none;
        }
        
        .supervisor-only {
            display: none;
        }
        
        .print-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 9999;
            overflow: auto;
        }
        
        .print-header {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .print-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .print-date {
            color: #666;
            margin-bottom: 20px;
        }
        
        .print-content {
            padding: 20px;
        }
        
        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .print-table th, .print-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .print-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .print-footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid #eee;
            font-size: 12px;
            color: #666;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-container, .print-container * {
                visibility: visible;
            }
            
            .print-container {
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-card">
            <div class="text-center mb-4">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="login-logo">
                <h3>Employee Management System</h3>
                <p class="text-muted">Please login to continue</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container" id="dashboardPage">
        <div class="header">
            <div class="header-brand">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="header-logo">
                <div>
                    <h4 class="header-title"><span class="brand-red-text">ASOBRICK</span> <span class="brand-gray-text">FACTORY</span></h4>
                    <p class="header-subtitle">Employee Management System</p>
                </div>
            </div>
            <div>
                <span id="userInfo" class="me-3"></span>
                <button class="btn btn-light btn-sm" id="logoutBtn">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>

        <div class="filter-section">
            <div class="row g-3">
                <div class="col-md-3">
                    <input type="text" class="form-control" id="searchName" placeholder="Search by name">
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="searchId" placeholder="Search by ID">
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterPosition">
                        <option value="">All Positions</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterDepartment">
                        <option value="">All Departments</option>
                        <option value="crushing-prep">Crushing & Preparation</option>
                        <option value="cutting-setting">Cutting & Setting</option>
                        <option value="klin">Klin</option>
                        <option value="unsetting">Unsetting</option>
                        <option value="mechanical">Mechanical</option>
                        <option value="electrical-ac">Electrical & AC</option>
                    </select>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <button class="btn btn-primary" id="filterBtn">
                        <i class="bi bi-funnel"></i> Apply Filters
                    </button>
                    <button class="btn btn-secondary ms-2" id="resetBtn">
                        <i class="bi bi-arrow-clockwise"></i> Reset
                    </button>
                    <button class="btn btn-success ms-2 admin-only" id="addEmployeeBtn">
                        <i class="bi bi-person-plus"></i> Add Employee
                    </button>
                    <button class="btn btn-success ms-2 admin-only" id="exportBtn">
                        <i class="bi bi-file-earmark-excel"></i> Export to Excel
                    </button>
                    <button class="btn btn-info ms-2 admin-and-supervisor-only" id="printBtn">
                        <i class="bi bi-printer"></i> Print
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                Employee List
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th onclick="sortTable('id')">ID <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('name')">Name <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('position')">Position <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('department')">Department <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('overallRating')">Overall Rating <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th>Daily Work</th>
                                <th>Other Work</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="employeeTableBody">
                            <!-- Employee rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="employeeModalLabel">Employee Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="employeeTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Details</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ratings-tab" data-bs-toggle="tab" data-bs-target="#ratings" type="button" role="tab" aria-controls="ratings" aria-selected="false">Ratings</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="employeeTabContent">
                        <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                            <form id="employeeForm">
                                <input type="hidden" id="employeeId">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="employeeIdInput" class="form-label">Employee ID</label>
                                        <input type="text" class="form-control" id="employeeIdInput" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="employeeName" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="employeeName" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="employeePosition" class="form-label">Position</label>
                                        <input type="text" class="form-control" id="employeePosition" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="employeeDepartment" class="form-label">Department</label>
                                        <select class="form-select" id="employeeDepartment" required>
                                            <option value="">Select Department</option>
                                            <option value="crushing-prep">Crushing & Preparation</option>
                                            <option value="cutting-setting">Cutting & Setting</option>
                                            <option value="klin">Klin</option>
                                            <option value="unsetting">Unsetting</option>
                                            <option value="mechanical">Mechanical</option>
                                            <option value="electrical-ac">Electrical & AC</option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="ratings" role="tabpanel" aria-labelledby="ratings-tab">
                            <!-- Different rating tabs based on department -->
                            <div id="productionRatings" style="display: none;">
                                <div class="mb-3">
                                    <h5>Daily Work Records</h5>
                                    <div id="dailyWorkContainer">
                                        <!-- Daily work entries will be inserted here -->
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary mt-2" id="addDailyWorkBtn">
                                        <i class="bi bi-plus-circle"></i> Add Daily Work Entry
                                    </button>
                                </div>
                                
                                <div class="mb-3 mt-4">
                                    <h5>Other Work Records</h5>
                                    <div id="otherWorkContainer">
                                        <!-- Other work entries will be inserted here -->
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary mt-2" id="addOtherWorkBtn">
                                        <i class="bi bi-plus-circle"></i> Add Other Work Entry
                                    </button>
                                </div>
                            </div>
                            
                            <div id="technicalRatings" style="display: none;">
                                <div class="mb-3">
                                    <h5>Work Records</h5>
                                    <div id="technicalWorkContainer">
                                        <!-- Technical work entries will be inserted here -->
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary mt-2" id="addTechnicalWorkBtn">
                                        <i class="bi bi-plus-circle"></i> Add Work Entry
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-4 p-3 bg-light rounded">
                                <h5>Overall Rating: <span id="overallRatingDisplay">0</span></h5>
                                <div class="progress">
                                    <div id="overallRatingBar" class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="0" aria-valuemin="-100" aria-valuemax="100">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger admin-only" id="deleteEmployeeBtn" style="display: none;">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                    <button type="button" class="btn btn-primary" id="saveEmployeeBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Work Records Page -->
    <div class="dashboard-container" id="workRecordsPage" style="display: none;">
        <div class="header">
            <div class="header-brand">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="header-logo">
                <div>
                    <h4 class="header-title"><span class="brand-red-text">ASOBRICK</span> <span class="brand-gray-text">FACTORY</span></h4>
                    <p class="header-subtitle">Work Records - <span id="currentEmployeeName"></span></p>
                </div>
            </div>
            <div>
                <button class="btn btn-light btn-sm" id="backToDashboardBtn">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>
        </div>

        <div class="record-tabs">
            <div class="record-tab active" id="dailyWorkTab">
                Daily Work Records <span class="record-count" id="dailyWorkCount">0</span>
            </div>
            <div class="record-tab" id="otherWorkTab">
                Other Work Records <span class="record-count" id="otherWorkCount">0</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="recordsTitle">Daily Work Records</h5>
                <button class="btn btn-sm btn-primary" id="addRecordBtn">
                    <i class="bi bi-plus-circle"></i> Add Record
                </button>
            </div>
            <div class="card-body">
                <div class="records-container" id="recordsContainer">
                    <!-- Work records will be inserted here -->
                </div>
            </div>
        </div>

        <button class="btn btn-primary add-record-btn" id="floatingAddBtn" style="display: none;">
            <i class="bi bi-plus"></i>
        </button>
    </div>

    <!-- Technical Work Records Page -->
    <div class="dashboard-container" id="technicalWorkPage" style="display: none;">
        <div class="header">
            <div class="header-brand">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="header-logo">
                <div>
                    <h4 class="header-title"><span class="brand-red-text">ASOBRICK</span> <span class="brand-gray-text">FACTORY</span></h4>
                    <p class="header-subtitle">Work Records - <span id="currentTechnicalEmployeeName"></span></p>
                </div>
            </div>
            <div>
                <button class="btn btn-light btn-sm" id="backToDashboardFromTechnicalBtn">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Work Records</h5>
                <button class="btn btn-sm btn-primary" id="addTechnicalRecordBtn">
                    <i class="bi bi-plus-circle"></i> Add Work Entry
                </button>
            </div>
            <div class="card-body">
                <div class="records-container" id="technicalRecordsContainer">
                    <!-- Technical work records will be inserted here -->
                </div>
            </div>
        </div>

        <button class="btn btn-primary add-record-btn" id="floatingTechnicalAddBtn" style="display: none;">
            <i class="bi bi-plus"></i>
        </button>
    </div>

    <!-- Add Daily Work Record Modal -->
    <div class="modal fade" id="addDailyWorkModal" tabindex="-1" aria-labelledby="addDailyWorkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDailyWorkModalLabel">Add Daily Work Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="dailyWorkForm">
                        <div class="mb-3">
                            <label for="dailyWorkDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="dailyWorkDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="dailyWorkCarts" class="form-label">Number of Carts</label>
                            <input type="number" class="form-control" id="dailyWorkCarts" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="dailyWorkRating" class="form-label">Rating (-100 to 100)</label>
                            <input type="range" class="form-range" id="dailyWorkRating" min="-100" max="100" value="0" required>
                            <div class="d-flex justify-content-between">
                                <span>-100</span>
                                <span id="dailyWorkRatingValue">0</span>
                                <span>100</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="dailyWorkNote" class="form-label">Note</label>
                            <textarea class="form-control" id="dailyWorkNote" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveDailyWorkBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Other Work Record Modal -->
    <div class="modal fade" id="addOtherWorkModal" tabindex="-1" aria-labelledby="addOtherWorkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addOtherWorkModalLabel">Add Other Work Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="otherWorkForm">
                        <div class="mb-3">
                            <label for="otherWorkDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="otherWorkDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="otherWorkName" class="form-label">Name of Work</label>
                            <input type="text" class="form-control" id="otherWorkName" required>
                        </div>
                        <div class="mb-3">
                            <label for="otherWorkRating" class="form-label">Rating (-100 to 100)</label>
                            <input type="range" class="form-range" id="otherWorkRating" min="-100" max="100" value="0" required>
                            <div class="d-flex justify-content-between">
                                <span>-100</span>
                                <span id="otherWorkRatingValue">0</span>
                                <span>100</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="otherWorkNote" class="form-label">Note</label>
                            <textarea class="form-control" id="otherWorkNote" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveOtherWorkBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Technical Work Record Modal -->
    <div class="modal fade" id="addTechnicalWorkModal" tabindex="-1" aria-labelledby="addTechnicalWorkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addTechnicalWorkModalLabel">Add Work Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="technicalWorkForm">
                        <div class="mb-3">
                            <label for="technicalWorkDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="technicalWorkDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkDescription" class="form-label">Work Description</label>
                            <input type="text" class="form-control" id="technicalWorkDescription" required>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkHours" class="form-label">Hours Taken</label>
                            <input type="number" class="form-control" id="technicalWorkHours" min="0.5" step="0.5" required>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkRating" class="form-label">Rating (-100 to 100)</label>
                            <input type="range" class="form-range" id="technicalWorkRating" min="-100" max="100" value="0" required>
                            <div class="d-flex justify-content-between">
                                <span>-100</span>
                                <span id="technicalWorkRatingValue">0</span>
                                <span>100</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkNote" class="form-label">Note</label>
                            <textarea class="form-control" id="technicalWorkNote" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveTechnicalWorkBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Preview Modal -->
    <div class="modal fade" id="printPreviewModal" tabindex="-1" aria-labelledby="printPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="printPreviewModalLabel">Print Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="printPreviewContent">
                        <!-- Print preview content will be inserted here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="confirmPrintBtn">
                        <i class="bi bi-printer"></i> Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Container -->
    <div class="print-container" id="printContainer">
        <div class="print-header">
            <div class="print-title">ASOBRICK FACTORY - Employee Report</div>
            <div class="print-date" id="printDate"></div>
        </div>
        <div class="print-content" id="printContent">
            <!-- Print content will be inserted here -->
        </div>
        <div class="print-footer">
            Generated by ASOBRICK FACTORY Employee Management System
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container">
        <div class="toast" id="notificationToast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Notification message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Firebase configuration - REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Data storage
        let employees = [];
        let currentUser = null;
        let editingEmployeeId = null;
        let currentEmployeeId = null;
        let sortColumn = 'overallRating';
        let sortDirection = 'desc';
        let currentRecordType = 'daily';
        
        // User credentials
        const users = {
            admin: { password: 'admin2002', role: 'admin', department: 'all' },
            himat: { password: 'himat6600', role: 'supervisor', department: 'cutting-setting' },
            'hemn-prep': { password: 'hemn1212', role: 'supervisor', department: 'crushing-prep' },
            samdar: { password: 'samdar7273', role: 'supervisor', department: 'unsetting' },
            'hemn-klin': { password: 'hemn2626', role: 'supervisor', department: 'klin' },
            sarezh: { password: 'sarezh1919', role: 'supervisor', department: 'electrical-ac' },
            shalaw: { password: 'shalaw0198', role: 'supervisor', department: 'mechanical' }
        };
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromStorage();
            setupEventListeners();
            
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }
        });
        
        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('filterBtn').addEventListener('click', applyFilters);
            document.getElementById('resetBtn').addEventListener('click', resetFilters);
            document.getElementById('exportBtn').addEventListener('click', exportToExcel);
            document.getElementById('printBtn').addEventListener('click', showPrintPreview);
            document.getElementById('addEmployeeBtn').addEventListener('click', openAddEmployeeModal);
            document.getElementById('saveEmployeeBtn').addEventListener('click', saveEmployee);
            document.getElementById('deleteEmployeeBtn').addEventListener('click', deleteEmployee);
            document.getElementById('addDailyWorkBtn').addEventListener('click', addDailyWorkEntry);
            document.getElementById('addOtherWorkBtn').addEventListener('click', addOtherWorkEntry);
            document.getElementById('addTechnicalWorkBtn').addEventListener('click', addTechnicalWorkEntry);
            document.getElementById('backToDashboardBtn').addEventListener('click', backToDashboard);
            document.getElementById('backToDashboardFromTechnicalBtn').addEventListener('click', backToDashboard);
            document.getElementById('dailyWorkTab').addEventListener('click', () => switchRecordType('daily'));
            document.getElementById('otherWorkTab').addEventListener('click', () => switchRecordType('other'));
            document.getElementById('addRecordBtn').addEventListener('click', function() {
                currentRecordType === 'daily' ? openAddDailyWorkModal() : openAddOtherWorkModal();
            });
            document.getElementById('addTechnicalRecordBtn').addEventListener('click', () => openAddTechnicalWorkModal());
            document.getElementById('floatingAddBtn').addEventListener('click', function() {
                currentRecordType === 'daily' ? openAddDailyWorkModal() : openAddOtherWorkModal();
            });
            document.getElementById('floatingTechnicalAddBtn').addEventListener('click', () => openAddTechnicalWorkModal());
            document.getElementById('saveDailyWorkBtn').addEventListener('click', saveDailyWorkRecord);
            document.getElementById('saveOtherWorkBtn').addEventListener('click', saveOtherWorkRecord);
            document.getElementById('saveTechnicalWorkBtn').addEventListener('click', saveTechnicalWorkRecord);
            document.getElementById('dailyWorkRating').addEventListener('input', function() {
                document.getElementById('dailyWorkRatingValue').textContent = this.value;
            });
            document.getElementById('otherWorkRating').addEventListener('input', function() {
                document.getElementById('otherWorkRatingValue').textContent = this.value;
            });
            document.getElementById('technicalWorkRating').addEventListener('input', function() {
                document.getElementById('technicalWorkRatingValue').textContent = this.value;
            });
            document.getElementById('confirmPrintBtn').addEventListener('click', function() {
                document.getElementById('printPreviewModal').classList.remove('show');
                window.print();
            });
        }
        
        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (users[username] && users[username].password === password) {
                currentUser = {
                    username: username,
                    role: users[username].role,
                    department: users[username].department
                };
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showDashboard();
                showNotification('Login successful', 'success');
            } else {
                showNotification('Invalid username or password', 'danger');
            }
        }
        
        // Handle logout
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('workRecordsPage').style.display = 'none';
            document.getElementById('technicalWorkPage').style.display = 'none';
            showNotification('Logged out successfully', 'success');
        }
        
        // Show dashboard
        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'block';
            document.getElementById('workRecordsPage').style.display = 'none';
            document.getElementById('technicalWorkPage').style.display = 'none';
            
            document.getElementById('userInfo').textContent = Logged in as: ${currentUser.username} (${currentUser.role});
            
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(element => {
                element.style.display = currentUser.role === 'admin' ? 'inline-block' : 'none';
            });
            
            const supervisorElements = document.querySelectorAll('.supervisor-only');
            supervisorElements.forEach(element => {
                element.style.display = currentUser.role === 'supervisor' ? 'inline-block' : 'none';
            });
            
            const adminAndSupervisorElements = document.querySelectorAll('.admin-and-supervisor-only');
            adminAndSupervisorElements.forEach(element => {
                element.style.display = (currentUser.role === 'admin' || currentUser.role === 'supervisor') ? 'inline-block' : 'none';
            });
            
            renderEmployeeTable();
            populatePositionFilter();
        }
        
        // Save data to Firebase and localStorage
        function saveDataToStorage() {
            localStorage.setItem('employees', JSON.stringify(employees));
            
            const employeesRef = db.collection('employees');
            employees.forEach(employee => {
                employeesRef.doc(employee.id).set(employee)
                    .then(() => console.log('Employee saved to Firebase:', employee.id))
                    .catch((error) => {
                        console.error('Error saving employee to Firebase:', error);
                        showNotification('Error saving data to cloud', 'danger');
                    });
            });
        }
        
        // Load data from Firebase or localStorage
        async function loadDataFromStorage() {
            try {
                const snapshot = await db.collection('employees').get();
                
                if (!snapshot.empty) {
                    employees = [];
                    snapshot.forEach(doc => employees.push(doc.data()));
                    showNotification('Data loaded from cloud', 'success');
                } else {
                    const savedEmployees = localStorage.getItem('employees');
                    if (savedEmployees) {
                        employees = JSON.parse(savedEmployees);
                        saveDataToStorage();
                    } else {
                        initializeSampleData();
                    }
                }
            } catch (error) {
                console.error('Error loading from Firebase:', error);
                const savedEmployees = localStorage.getItem('employees');
                if (savedEmployees) {
                    employees = JSON.parse(savedEmployees);
                    showNotification('Using local data (cloud unavailable)', 'warning');
                } else {
                    initializeSampleData();
                }
            }
        }
        
        // Save individual employee to Firebase
        function saveEmployeeToFirebase(employee) {
            db.collection('employees').doc(employee.id).set(employee)
                .then(() => console.log('Employee updated in Firebase:', employee.id))
                .catch((error) => {
                    console.error('Error updating employee in Firebase:', error);
                    showNotification('Error saving to cloud', 'danger');
                });
            
            const index = employees.findIndex(emp => emp.id === employee.id);
            if (index !== -1) employees[index] = employee;
            localStorage.setItem('employees', JSON.stringify(employees));
        }
        
        // Initialize with sample data
        function initializeSampleData() {
            employees = [
                {
                    id: 'EMP001',
                    name: 'emp 1',
                    position: 'Worker',
                    department: 'crushing-prep',
                    dailyWork: [
                        { date: '2023-01-01', carts: '10', rate: '75', note: 'Good performance' }
                    ],
                    otherWork: [
                        { date: '2023-01-01', name: 'Machine Maintenance', rate: '65', note: 'Needs improvement' }
                    ]
                },
                {
                    id: 'EMP002',
                    name: 'emp 2',
                    position: 'Operator',
                    department: 'crushing-prep',
                    dailyWork: [
                        { date: '2023-01-01', carts: '15', rate: '80', note: 'Consistent performance' }
                    ]
                },
                {
                    id: 'EMP007',
                    name: 'emp 7',
                    position: 'Mechanic',
                    department: 'mechanical',
                    technicalWork: [
                        { date: '2023-01-01', description: 'Engine Repair', hours: '4', rate: '75', note: 'Good work' }
                    ]
                },
                {
                    id: 'EMP008',
                    name: 'emp 8',
                    position: 'Electrician',
                    department: 'electrical-ac',
                    technicalWork: [
                        { date: '2023-01-01', description: 'AC Installation', hours: '5', rate: '80', note: 'Good work' }
                    ]
                }
            ];
            saveDataToStorage();
        }
        
        // Sort table
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            renderEmployeeTable();
        }
        
        // Render employee table
        function renderEmployeeTable(filteredEmployees = null) {
            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = '';
            
            let employeesToShow = filteredEmployees || employees;
            if (currentUser.role !== 'admin') {
                employeesToShow = employeesToShow.filter(emp => emp.department === currentUser.department);
            }
            
            if (employeesToShow.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="8" class="text-center">No employees found</td>';
                tbody.appendChild(row);
                return;
            }
            
            employeesToShow.sort((a, b) => {
                let valueA, valueB;
                
                switch (sortColumn) {
                    case 'id': valueA = a.id; valueB = b.id; break;
                    case 'name': valueA = a.name; valueB = b.name; break;
                    case 'position': valueA = a.position; valueB = b.position; break;
                    case 'department': valueA = a.department; valueB = b.department; break;
                    case 'overallRating': valueA = calculateOverallRating(a); valueB = calculateOverallRating(b); break;
                    default: return 0;
                }
                
                if (typeof valueA === 'string') {
                    return sortDirection === 'asc' ? valueA.localeCompare(valueB) : valueB.localeCompare(valueA);
                } else {
                    return sortDirection === 'asc' ? valueA - valueB : valueB - valueA;
                }
            });
            
            employeesToShow.forEach(employee => {
                const row = document.createElement('tr');
                const overallRating = calculateOverallRating(employee);
                const ratingClass = getRatingClass(overallRating);
                
                let dailyWorkDisplay = '';
                let otherWorkDisplay = '';
                
                if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                    const technicalWorkCount = employee.technicalWork ? employee.technicalWork.length : 0;
                    dailyWorkDisplay = 'N/A';
                    otherWorkDisplay = ${technicalWorkCount} work records;
                } else {
                    const dailyWorkCount = employee.dailyWork ? employee.dailyWork.length : 0;
                    const otherWorkCount = employee.otherWork ? employee.otherWork.length : 0;
                    dailyWorkDisplay = dailyWorkCount > 0 ? ${dailyWorkCount} entries : 'No entries';
                    otherWorkDisplay = otherWorkCount > 0 ? ${otherWorkCount} entries : 'No entries';
                }
                
                let departmentDisplay = employee.department;
                if (employee.department === 'crushing-prep') departmentDisplay = 'Crushing & Preparation';
                else if (employee.department === 'cutting-setting') departmentDisplay = 'Cutting & Setting';
                
                row.innerHTML = `
                    <td>${employee.id}</td>
                    <td>${employee.name}</td>
                    <td>${employee.position}</td>
                    <td>${departmentDisplay}</td>
                    <td><span class="badge rating-badge ${ratingClass}">${overallRating.toFixed(1)}</span></td>
                    <td>${dailyWorkDisplay}</td>
                    <td>${otherWorkDisplay}</td>
                    <td>
                        <button class="btn btn-sm btn-primary view-employee-btn" data-id="${employee.id}">
                            <i class="bi bi-eye"></i> View
                        </button>
                        <button class="btn btn-sm btn-info work-records-btn ms-1" data-id="${employee.id}">
                            <i class="bi bi-clipboard-data"></i> Records
                        </button>
                        ${currentUser.role === 'admin' ? `
                        <button class="btn btn-sm btn-warning edit-employee-btn ms-1" data-id="${employee.id}">
                            <i class="bi bi-pencil"></i> Edit
                        </button>` : ''}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            document.querySelectorAll('.view-employee-btn').forEach(btn => {
                btn.addEventListener('click', function() { viewEmployee(this.dataset.id); });
            });
            
            document.querySelectorAll('.edit-employee-btn').forEach(btn => {
                btn.addEventListener('click', function() { editEmployee(this.dataset.id); });
            });
            
            document.querySelectorAll('.work-records-btn').forEach(btn => {
                btn.addEventListener('click', function() { viewWorkRecords(this.dataset.id); });
            });
        }
        
        // Calculate overall rating
        function calculateOverallRating(employee) {
            let totalRating = 0;
            let count = 0;
            
            if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                if (employee.technicalWork && employee.technicalWork.length > 0) {
                    totalRating = employee.technicalWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                    count = employee.technicalWork.length;
                }
            } else {
                if (employee.dailyWork && employee.dailyWork.length > 0) {
                    const dailySum = employee.dailyWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                    totalRating += dailySum / employee.dailyWork.length;
                    count++;
                }
                
                if (employee.otherWork && employee.otherWork.length > 0) {
                    const otherSum = employee.otherWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                    totalRating += otherSum / employee.otherWork.length;
                    count++;
                }
            }
            
            return count > 0 ? totalRating / count : 0;
        }
        
        // Get rating class for styling
        function getRatingClass(rating) {
            if (rating >= 50) return 'rating-excellent';
            if (rating >= 20) return 'rating-good';
            if (rating >= -20) return 'rating-average';
            return 'rating-poor';
        }
        
        // Get rating class for work records
        function getWorkRecordClass(rating) {
            if (rating >= 50) return 'rating-positive';
            if (rating >= -50) return 'rating-neutral';
            return 'rating-negative';
        }
        
        // Apply filters
        function applyFilters() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchId = document.getElementById('searchId').value.toLowerCase();
            const filterPosition = document.getElementById('filterPosition').value;
            const filterDepartment = document.getElementById('filterDepartment').value;
            
            let filteredEmployees = employees;
            
            if (searchName) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.name.toLowerCase().includes(searchName)
                );
            }
            
            if (searchId) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.id.toLowerCase().includes(searchId)
                );
            }
            
            if (filterPosition) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.position === filterPosition
                );
            }
            
            if (filterDepartment) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.department === filterDepartment
                );
            }
            
            renderEmployeeTable(filteredEmployees);
        }
        
        // Reset filters
        function resetFilters() {
            document.getElementById('searchName').value = '';
            document.getElementById('searchId').value = '';
            document.getElementById('filterPosition').value = '';
            document.getElementById('filterDepartment').value = '';
            renderEmployeeTable();
        }
        
        // Populate position filter dropdown
        function populatePositionFilter() {
            const positions = [...new Set(employees.map(emp => emp.position))];
            const filterPosition = document.getElementById('filterPosition');
            
            while (filterPosition.options.length > 1) {
                filterPosition.remove(1);
            }
            
            positions.forEach(position => {
                const option = document.createElement('option');
                option.value = position;
                option.textContent = position;
                filterPosition.appendChild(option);
            });
        }
        
        // Export to Excel function
        function exportToExcel() {
            if (currentUser.role !== 'admin') {
                showNotification('Access denied. Only admin can export data.', 'danger');
                return;
            }
            
            let employeesToExport = employees;
            
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchId = document.getElementById('searchId').value.toLowerCase();
            const filterPosition = document.getElementById('filterPosition').value;
            const filterDepartment = document.getElementById('filterDepartment').value;
            
            if (searchName) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.name.toLowerCase().includes(searchName)
                );
            }
            
            if (searchId) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.id.toLowerCase().includes(searchId)
                );
            }
            
            if (filterPosition) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.position === filterPosition
                );
            }
            
            if (filterDepartment) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.department === filterDepartment
                );
            }
            
            let csvContent = "Employee ID,Name,Position,Department,Overall Rating,Work Records Count\n";
            
            employeesToExport.forEach(employee => {
                const overallRating = calculateOverallRating(employee);
                
                let workRecordsCount = 0;
                if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                    workRecordsCount = employee.technicalWork ? employee.technicalWork.length : 0;
                } else {
                    const dailyWorkCount = employee.dailyWork ? employee.dailyWork.length : 0;
                    const otherWorkCount = employee.otherWork ? employee.otherWork.length : 0;
                    workRecordsCount = dailyWorkCount + otherWorkCount;
                }
                
                let departmentDisplay = employee.department;
                if (employee.department === 'crushing-prep') departmentDisplay = 'Crushing & Preparation';
                else if (employee.department === 'cutting-setting') departmentDisplay = 'Cutting & Setting';
                
                csvContent += ${employee.id},${employee.name},${employee.position},${departmentDisplay},${overallRating.toFixed(1)},${workRecordsCount}\n;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const filename = employee_ratings_${dateStr}.csv;
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Employee ratings exported successfully', 'success');
        }
        
        // Show print preview
        function showPrintPreview() {
            let employeesToPrint = employees;
            
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchId = document.getElementById('searchId').value.toLowerCase();
            const filterPosition = document.getElementById('filterPosition').value;
            const filterDepartment = document.getElementById('filterDepartment').value;
            
            if (searchName) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.name.toLowerCase().includes(searchName)
                );
            }
            
            if (searchId) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.id.toLowerCase().includes(searchId)
                );
            }
            
            if (filterPosition) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.position === filterPosition
                );
            }
            
            if (filterDepartment) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.department === filterDepartment
                );