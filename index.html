<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASOBRICK FACTORY - Employee Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --brand-red: #e74c3c;
        }
        
        body {
            background-color: #f5f7fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .login-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3498db, #2c3e50);
        }
        
        .login-card {
            width: 400px;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        
        .login-logo {
            max-width: 200px;
            margin-bottom: 20px;
        }
        
        .dashboard-container {
            display: none;
            padding: 20px;
        }
        
        .header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-logo {
            height: 60px;
            margin-right: 20px;
        }
        
        .header-brand {
            display: flex;
            align-items: center;
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
            margin: 0;
        }
        
        .header-subtitle {
            font-size: 0.9rem;
            color: #bdc3c7;
            margin: 0;
        }
        
        .card {
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px 8px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
            border-color: #27ae60;
        }
        
        .btn-info {
            background-color: #17a2b8;
            border-color: #17a2b8;
        }
        
        .btn-info:hover {
            background-color: #138496;
            border-color: #117a8b;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            cursor: pointer;
        }
        
        .table th:hover {
            background-color: #e9ecef;
        }
        
        .sort-icon {
            margin-left: 5px;
            font-size: 0.8em;
        }
        
        .rating-badge {
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .rating-excellent {
            background-color: #d4edda;
            color: #155724;
        }
        
        .rating-good {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .rating-average {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .rating-poor {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .filter-section {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .work-entry {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .mechanical-entry {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .electrical-entry {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            min-width: 300px;
        }
        
        .brand-red-text {
            color: var(--brand-red);
            font-weight: 700;
        }
        
        .brand-gray-text {
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .work-record-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        
        .work-record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .work-record-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .work-record-date {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .work-record-rating {
            font-size: 1.2rem;
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .rating-positive {
            background-color: #d4edda;
            color: #155724;
        }
        
        .rating-neutral {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .rating-negative {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .work-record-note {
            margin-top: 10px;
        }
        
        .add-record-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .tab-content {
            min-height: 400px;
        }
        
        .records-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .records-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .records-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .records-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .records-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .record-tabs {
            margin-bottom: 15px;
        }
        
        .record-tab {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            cursor: pointer;
            display: inline-block;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .record-tab.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .record-count {
            background-color: #6c757d;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        .admin-only {
            display: none;
        }
        
        .supervisor-only {
            display: none;
        }
        
        .print-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 9999;
            overflow: auto;
        }
        
        .print-header {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .print-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .print-date {
            color: #666;
            margin-bottom: 20px;
        }
        
        .print-content {
            padding: 20px;
        }
        
        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .print-table th, .print-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .print-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .print-footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid #eee;
            font-size: 12px;
            color: #666;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-container, .print-container * {
                visibility: visible;
            }
            
            .print-container {
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-card">
            <div class="text-center mb-4">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="login-logo">
                <h3>Employee Management System</h3>
                <p class="text-muted">Please login to continue</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container" id="dashboardPage">
        <div class="header">
            <div class="header-brand">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="header-logo">
                <div>
                    <h4 class="header-title"><span class="brand-red-text">ASOBRICK</span> <span class="brand-gray-text">FACTORY</span></h4>
                    <p class="header-subtitle">Employee Management System</p>
                </div>
            </div>
            <div>
                <span id="userInfo" class="me-3"></span>
                <button class="btn btn-light btn-sm" id="logoutBtn">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>

        <div class="filter-section">
            <div class="row g-3">
                <div class="col-md-3">
                    <input type="text" class="form-control" id="searchName" placeholder="Search by name">
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="searchId" placeholder="Search by ID">
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterPosition">
                        <option value="">All Positions</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterDepartment">
                        <option value="">All Departments</option>
                        <option value="crushing-prep">Crushing & Preparation</option>
                        <option value="cutting-setting">Cutting & Setting</option>
                        <option value="klin">Klin</option>
                        <option value="unsetting">Unsetting</option>
                        <option value="mechanical">Mechanical</option>
                        <option value="electrical-ac">Electrical & AC</option>
                    </select>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <button class="btn btn-primary" id="filterBtn">
                        <i class="bi bi-funnel"></i> Apply Filters
                    </button>
                    <button class="btn btn-secondary ms-2" id="resetBtn">
                        <i class="bi bi-arrow-clockwise"></i> Reset
                    </button>
                    <button class="btn btn-success ms-2 admin-only" id="addEmployeeBtn">
                        <i class="bi bi-person-plus"></i> Add Employee
                    </button>
                    <button class="btn btn-success ms-2 admin-only" id="exportBtn">
                        <i class="bi bi-file-earmark-excel"></i> Export to Excel
                    </button>
                    <button class="btn btn-info ms-2 admin-and-supervisor-only" id="printBtn">
                        <i class="bi bi-printer"></i> Print
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                Employee List
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th onclick="sortTable('id')">ID <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('name')">Name <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('position')">Position <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('department')">Department <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th onclick="sortTable('overallRating')">Overall Rating <i class="bi bi-arrow-down-up sort-icon"></i></th>
                                <th>Daily Work</th>
                                <th>Other Work</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="employeeTableBody">
                            <!-- Employee rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="employeeModalLabel">Employee Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="employeeTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Details</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ratings-tab" data-bs-toggle="tab" data-bs-target="#ratings" type="button" role="tab" aria-controls="ratings" aria-selected="false">Ratings</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="employeeTabContent">
                        <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                            <form id="employeeForm">
                                <input type="hidden" id="employeeId">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="employeeIdInput" class="form-label">Employee ID</label>
                                        <input type="text" class="form-control" id="employeeIdInput" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="employeeName" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="employeeName" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="employeePosition" class="form-label">Position</label>
                                        <input type="text" class="form-control" id="employeePosition" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="employeeDepartment" class="form-label">Department</label>
                                        <select class="form-select" id="employeeDepartment" required>
                                            <option value="">Select Department</option>
                                            <option value="crushing-prep">Crushing & Preparation</option>
                                            <option value="cutting-setting">Cutting & Setting</option>
                                            <option value="klin">Klin</option>
                                            <option value="unsetting">Unsetting</option>
                                            <option value="mechanical">Mechanical</option>
                                            <option value="electrical-ac">Electrical & AC</option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="ratings" role="tabpanel" aria-labelledby="ratings-tab">
                            <!-- Different rating tabs based on department -->
                            <div id="productionRatings" style="display: none;">
                                <div class="mb-3">
                                    <h5>Daily Work Records</h5>
                                    <div id="dailyWorkContainer">
                                        <!-- Daily work entries will be inserted here -->
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary mt-2" id="addDailyWorkBtn">
                                        <i class="bi bi-plus-circle"></i> Add Daily Work Entry
                                    </button>
                                </div>
                                
                                <div class="mb-3 mt-4">
                                    <h5>Other Work Records</h5>
                                    <div id="otherWorkContainer">
                                        <!-- Other work entries will be inserted here -->
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary mt-2" id="addOtherWorkBtn">
                                        <i class="bi bi-plus-circle"></i> Add Other Work Entry
                                    </button>
                                </div>
                            </div>
                            
                            <div id="technicalRatings" style="display: none;">
                                <div class="mb-3">
                                    <h5>Work Records</h5>
                                    <div id="technicalWorkContainer">
                                        <!-- Technical work entries will be inserted here -->
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary mt-2" id="addTechnicalWorkBtn">
                                        <i class="bi bi-plus-circle"></i> Add Work Entry
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-4 p-3 bg-light rounded">
                                <h5>Overall Rating: <span id="overallRatingDisplay">0</span></h5>
                                <div class="progress">
                                    <div id="overallRatingBar" class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="0" aria-valuemin="-100" aria-valuemax="100">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger admin-only" id="deleteEmployeeBtn" style="display: none;">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                    <button type="button" class="btn btn-primary" id="saveEmployeeBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Work Records Page -->
    <div class="dashboard-container" id="workRecordsPage" style="display: none;">
        <div class="header">
            <div class="header-brand">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="header-logo">
                <div>
                    <h4 class="header-title"><span class="brand-red-text">ASOBRICK</span> <span class="brand-gray-text">FACTORY</span></h4>
                    <p class="header-subtitle">Work Records - <span id="currentEmployeeName"></span></p>
                </div>
            </div>
            <div>
                <button class="btn btn-light btn-sm" id="backToDashboardBtn">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>
        </div>

        <div class="record-tabs">
            <div class="record-tab active" id="dailyWorkTab">
                Daily Work Records <span class="record-count" id="dailyWorkCount">0</span>
            </div>
            <div class="record-tab" id="otherWorkTab">
                Other Work Records <span class="record-count" id="otherWorkCount">0</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="recordsTitle">Daily Work Records</h5>
                <button class="btn btn-sm btn-primary" id="addRecordBtn">
                    <i class="bi bi-plus-circle"></i> Add Record
                </button>
            </div>
            <div class="card-body">
                <div class="records-container" id="recordsContainer">
                    <!-- Work records will be inserted here -->
                </div>
            </div>
        </div>

        <button class="btn btn-primary add-record-btn" id="floatingAddBtn" style="display: none;">
            <i class="bi bi-plus"></i>
        </button>
    </div>

    <!-- Technical Work Records Page -->
    <div class="dashboard-container" id="technicalWorkPage" style="display: none;">
        <div class="header">
            <div class="header-brand">
                <img src="https://z-cdn-media.chatglm.cn/files/588e3070-4da2-4621-a23a-c3797a169aba_Aso-Brick-Factory.jpg?auth_key=1863555089-bc9d1e326da44c9cb276be8d7a836996-0-f6131313ba165c0b30ea85ee637714fe" alt="ASOBRICK FACTORY" class="header-logo">
                <div>
                    <h4 class="header-title"><span class="brand-red-text">ASOBRICK</span> <span class="brand-gray-text">FACTORY</span></h4>
                    <p class="header-subtitle">Work Records - <span id="currentTechnicalEmployeeName"></span></p>
                </div>
            </div>
            <div>
                <button class="btn btn-light btn-sm" id="backToDashboardFromTechnicalBtn">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Work Records</h5>
                <button class="btn btn-sm btn-primary" id="addTechnicalRecordBtn">
                    <i class="bi bi-plus-circle"></i> Add Work Entry
                </button>
            </div>
            <div class="card-body">
                <div class="records-container" id="technicalRecordsContainer">
                    <!-- Technical work records will be inserted here -->
                </div>
            </div>
        </div>

        <button class="btn btn-primary add-record-btn" id="floatingTechnicalAddBtn" style="display: none;">
            <i class="bi bi-plus"></i>
        </button>
    </div>

    <!-- Add Daily Work Record Modal -->
    <div class="modal fade" id="addDailyWorkModal" tabindex="-1" aria-labelledby="addDailyWorkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDailyWorkModalLabel">Add Daily Work Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="dailyWorkForm">
                        <div class="mb-3">
                            <label for="dailyWorkDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="dailyWorkDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="dailyWorkCarts" class="form-label">Number of Carts</label>
                            <input type="number" class="form-control" id="dailyWorkCarts" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="dailyWorkRating" class="form-label">Rating (-100 to 100)</label>
                            <input type="range" class="form-range" id="dailyWorkRating" min="-100" max="100" value="0" required>
                            <div class="d-flex justify-content-between">
                                <span>-100</span>
                                <span id="dailyWorkRatingValue">0</span>
                                <span>100</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="dailyWorkNote" class="form-label">Note</label>
                            <textarea class="form-control" id="dailyWorkNote" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveDailyWorkBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Other Work Record Modal -->
    <div class="modal fade" id="addOtherWorkModal" tabindex="-1" aria-labelledby="addOtherWorkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addOtherWorkModalLabel">Add Other Work Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="otherWorkForm">
                        <div class="mb-3">
                            <label for="otherWorkDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="otherWorkDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="otherWorkName" class="form-label">Name of Work</label>
                            <input type="text" class="form-control" id="otherWorkName" required>
                        </div>
                        <div class="mb-3">
                            <label for="otherWorkRating" class="form-label">Rating (-100 to 100)</label>
                            <input type="range" class="form-range" id="otherWorkRating" min="-100" max="100" value="0" required>
                            <div class="d-flex justify-content-between">
                                <span>-100</span>
                                <span id="otherWorkRatingValue">0</span>
                                <span>100</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="otherWorkNote" class="form-label">Note</label>
                            <textarea class="form-control" id="otherWorkNote" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveOtherWorkBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Technical Work Record Modal -->
    <div class="modal fade" id="addTechnicalWorkModal" tabindex="-1" aria-labelledby="addTechnicalWorkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addTechnicalWorkModalLabel">Add Work Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="technicalWorkForm">
                        <div class="mb-3">
                            <label for="technicalWorkDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="technicalWorkDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkDescription" class="form-label">Work Description</label>
                            <input type="text" class="form-control" id="technicalWorkDescription" required>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkHours" class="form-label">Hours Taken</label>
                            <input type="number" class="form-control" id="technicalWorkHours" min="0.5" step="0.5" required>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkRating" class="form-label">Rating (-100 to 100)</label>
                            <input type="range" class="form-range" id="technicalWorkRating" min="-100" max="100" value="0" required>
                            <div class="d-flex justify-content-between">
                                <span>-100</span>
                                <span id="technicalWorkRatingValue">0</span>
                                <span>100</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="technicalWorkNote" class="form-label">Note</label>
                            <textarea class="form-control" id="technicalWorkNote" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveTechnicalWorkBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Preview Modal -->
    <div class="modal fade" id="printPreviewModal" tabindex="-1" aria-labelledby="printPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="printPreviewModalLabel">Print Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="printPreviewContent">
                        <!-- Print preview content will be inserted here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="confirmPrintBtn">
                        <i class="bi bi-printer"></i> Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Container -->
    <div class="print-container" id="printContainer">
        <div class="print-header">
            <div class="print-title">ASOBRICK FACTORY - Employee Report</div>
            <div class="print-date" id="printDate"></div>
        </div>
        <div class="print-content" id="printContent">
            <!-- Print content will be inserted here -->
        </div>
        <div class="print-footer">
            Generated by ASOBRICK FACTORY Employee Management System
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container">
        <div class="toast" id="notificationToast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Notification message will be inserted here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data storage
        let employees = [];
        let currentUser = null;
        let editingEmployeeId = null;
        let currentEmployeeId = null;
        let sortColumn = 'overallRating';
        let sortDirection = 'desc';
        let currentRecordType = 'daily'; // 'daily' or 'other'
        
        // User credentials with updated passwords
        const users = {
            admin: { password: 'admin2002', role: 'admin', department: 'all' },
            himat: { password: 'himat6600', role: 'supervisor', department: 'cutting-setting' },
            'hemn-prep': { password: 'hemn1212', role: 'supervisor', department: 'crushing-prep' },
            samdar: { password: 'samdar7273', role: 'supervisor', department: 'unsetting' },
            'hemn-klin': { password: 'hemn2626', role: 'supervisor', department: 'klin' },
            sarezh: { password: 'sarezh1919', role: 'supervisor', department: 'electrical-ac' },
            shalaw: { password: 'shalaw0198', role: 'supervisor', department: 'mechanical' }
        };
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadDataFromStorage();
            
            // Setup event listeners
            setupEventListeners();
            
            // Check if already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Filter buttons
            document.getElementById('filterBtn').addEventListener('click', applyFilters);
            document.getElementById('resetBtn').addEventListener('click', resetFilters);
            
            // Export button
            document.getElementById('exportBtn').addEventListener('click', exportToExcel);
            
            // Print button
            document.getElementById('printBtn').addEventListener('click', showPrintPreview);
            
            // Add employee button
            document.getElementById('addEmployeeBtn').addEventListener('click', openAddEmployeeModal);
            
            // Save employee button
            document.getElementById('saveEmployeeBtn').addEventListener('click', saveEmployee);
            
            // Delete employee button
            document.getElementById('deleteEmployeeBtn').addEventListener('click', deleteEmployee);
            
            // Add work entry buttons
            document.getElementById('addDailyWorkBtn').addEventListener('click', addDailyWorkEntry);
            document.getElementById('addOtherWorkBtn').addEventListener('click', addOtherWorkEntry);
            document.getElementById('addTechnicalWorkBtn').addEventListener('click', addTechnicalWorkEntry);
            
            // Back to dashboard button
            document.getElementById('backToDashboardBtn').addEventListener('click', backToDashboard);
            document.getElementById('backToDashboardFromTechnicalBtn').addEventListener('click', backToDashboard);
            
            // Record tabs
            document.getElementById('dailyWorkTab').addEventListener('click', function() {
                switchRecordType('daily');
            });
            
            document.getElementById('otherWorkTab').addEventListener('click', function() {
                switchRecordType('other');
            });
            
            // Add work record buttons
            document.getElementById('addRecordBtn').addEventListener('click', function() {
                if (currentRecordType === 'daily') {
                    openAddDailyWorkModal();
                } else {
                    openAddOtherWorkModal();
                }
            });
            
            document.getElementById('addTechnicalRecordBtn').addEventListener('click', function() {
                openAddTechnicalWorkModal();
            });
            
            document.getElementById('floatingAddBtn').addEventListener('click', function() {
                if (currentRecordType === 'daily') {
                    openAddDailyWorkModal();
                } else {
                    openAddOtherWorkModal();
                }
            });
            
            document.getElementById('floatingTechnicalAddBtn').addEventListener('click', function() {
                openAddTechnicalWorkModal();
            });
            
            // Save work record buttons
            document.getElementById('saveDailyWorkBtn').addEventListener('click', saveDailyWorkRecord);
            document.getElementById('saveOtherWorkBtn').addEventListener('click', saveOtherWorkRecord);
            document.getElementById('saveTechnicalWorkBtn').addEventListener('click', saveTechnicalWorkRecord);
            
            // Rating range inputs
            document.getElementById('dailyWorkRating').addEventListener('input', function() {
                document.getElementById('dailyWorkRatingValue').textContent = this.value;
            });
            
            document.getElementById('otherWorkRating').addEventListener('input', function() {
                document.getElementById('otherWorkRatingValue').textContent = this.value;
            });
            
            document.getElementById('technicalWorkRating').addEventListener('input', function() {
                document.getElementById('technicalWorkRatingValue').textContent = this.value;
            });
            
            // Print confirmation button
            document.getElementById('confirmPrintBtn').addEventListener('click', function() {
                document.getElementById('printPreviewModal').classList.remove('show');
                window.print();
            });
        }
        
        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (users[username] && users[username].password === password) {
                currentUser = {
                    username: username,
                    role: users[username].role,
                    department: users[username].department
                };
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showDashboard();
                showNotification('Login successful', 'success');
            } else {
                showNotification('Invalid username or password', 'danger');
            }
        }
        
        // Handle logout
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('workRecordsPage').style.display = 'none';
            document.getElementById('technicalWorkPage').style.display = 'none';
            showNotification('Logged out successfully', 'success');
        }
        
        // Show dashboard
        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'block';
            document.getElementById('workRecordsPage').style.display = 'none';
            document.getElementById('technicalWorkPage').style.display = 'none';
            
            // Update user info
            document.getElementById('userInfo').textContent = `Logged in as: ${currentUser.username} (${currentUser.role})`;
            
            // Show/hide admin-only elements
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(element => {
                if (currentUser.role === 'admin') {
                    element.style.display = 'inline-block';
                } else {
                    element.style.display = 'none';
                }
            });
            
            // Show/hide supervisor-only elements
            const supervisorElements = document.querySelectorAll('.supervisor-only');
            supervisorElements.forEach(element => {
                if (currentUser.role === 'supervisor') {
                    element.style.display = 'inline-block';
                } else {
                    element.style.display = 'none';
                }
            });
            
            // Show/hide admin and supervisor elements
            const adminAndSupervisorElements = document.querySelectorAll('.admin-and-supervisor-only');
            adminAndSupervisorElements.forEach(element => {
                if (currentUser.role === 'admin' || currentUser.role === 'supervisor') {
                    element.style.display = 'inline-block';
                } else {
                    element.style.display = 'none';
                }
            });
            
            // Load and display employees
            renderEmployeeTable();
            
            // Populate position filter
            populatePositionFilter();
        }
        
        // Export to Excel function
        function exportToExcel() {
            // Only allow admin to export
            if (currentUser.role !== 'admin') {
                showNotification('Access denied. Only admin can export data.', 'danger');
                return;
            }
            
            // Get employees to export (filtered or all)
            let employeesToExport = employees;
            
            // Apply current filters if any
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchId = document.getElementById('searchId').value.toLowerCase();
            const filterPosition = document.getElementById('filterPosition').value;
            const filterDepartment = document.getElementById('filterDepartment').value;
            
            // Filter by name
            if (searchName) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.name.toLowerCase().includes(searchName)
                );
            }
            
            // Filter by ID
            if (searchId) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.id.toLowerCase().includes(searchId)
                );
            }
            
            // Filter by position
            if (filterPosition) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.position === filterPosition
                );
            }
            
            // Filter by department
            if (filterDepartment) {
                employeesToExport = employeesToExport.filter(emp => 
                    emp.department === filterDepartment
                );
            }
            
            // Create CSV content
            let csvContent = "Employee ID,Name,Position,Department,Overall Rating,Work Records Count\n";
            
            employeesToExport.forEach(employee => {
                const overallRating = calculateOverallRating(employee);
                
                // Count work records based on department type
                let workRecordsCount = 0;
                if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                    workRecordsCount = employee.technicalWork ? employee.technicalWork.length : 0;
                } else {
                    const dailyWorkCount = employee.dailyWork ? employee.dailyWork.length : 0;
                    const otherWorkCount = employee.otherWork ? employee.otherWork.length : 0;
                    workRecordsCount = dailyWorkCount + otherWorkCount;
                }
                
                // Format department name for display
                let departmentDisplay = employee.department;
                if (employee.department === 'crushing-prep') {
                    departmentDisplay = 'Crushing & Preparation';
                } else if (employee.department === 'cutting-setting') {
                    departmentDisplay = 'Cutting & Setting';
                }
                
                csvContent += `${employee.id},${employee.name},${employee.position},${departmentDisplay},${overallRating.toFixed(1)},${workRecordsCount}\n`;
            });
            
            // Create a blob with CSV content
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // Create a link element and trigger download
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            // Generate filename with current date
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD format
            const filename = `employee_ratings_${dateStr}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Employee ratings exported successfully', 'success');
        }
        
        // Show print preview
        function showPrintPreview() {
            // Get employees to print (filtered or all)
            let employeesToPrint = employees;
            
            // Apply current filters if any
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchId = document.getElementById('searchId').value.toLowerCase();
            const filterPosition = document.getElementById('filterPosition').value;
            const filterDepartment = document.getElementById('filterDepartment').value;
            
            // Filter by name
            if (searchName) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.name.toLowerCase().includes(searchName)
                );
            }
            
            // Filter by ID
            if (searchId) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.id.toLowerCase().includes(searchId)
                );
            }
            
            // Filter by position
            if (filterPosition) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.position === filterPosition
                );
            }
            
            // Filter by department
            if (filterDepartment) {
                employeesToPrint = employeesToPrint.filter(emp => 
                    emp.department === filterDepartment
                );
            }
            
            // If not admin, filter by department
            if (currentUser.role !== 'admin') {
                employeesToPrint = employeesToPrint.filter(emp => emp.department === currentUser.department);
            }
            
            // Generate print preview content
            let printContent = '<table class="print-table">';
            printContent += '<thead><tr><th>Employee ID</th><th>Name</th><th>Position</th><th>Department</th><th>Overall Rating</th><th>Work Records</th></tr></thead>';
            printContent += '<tbody>';
            
            employeesToPrint.forEach(employee => {
                const overallRating = calculateOverallRating(employee);
                
                // Get work records summary based on department type
                let workRecordsSummary = '';
                if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                    workRecordsSummary = `${employee.technicalWork ? employee.technicalWork.length : 0} work records`;
                } else {
                    const dailyWorkCount = employee.dailyWork ? employee.dailyWork.length : 0;
                    const otherWorkCount = employee.otherWork ? employee.otherWork.length : 0;
                    workRecordsSummary = `${dailyWorkCount} daily, ${otherWorkCount} other work records`;
                }
                
                // Format department name for display
                let departmentDisplay = employee.department;
                if (employee.department === 'crushing-prep') {
                    departmentDisplay = 'Crushing & Preparation';
                } else if (employee.department === 'cutting-setting') {
                    departmentDisplay = 'Cutting & Setting';
                }
                
                printContent += `<tr>
                    <td>${employee.id}</td>
                    <td>${employee.name}</td>
                    <td>${employee.position}</td>
                    <td>${departmentDisplay}</td>
                    <td>${overallRating.toFixed(1)}</td>
                    <td>${workRecordsSummary}</td>
                </tr>`;
            });
            
            printContent += '</tbody></table>';
            
            // Update print preview content
            document.getElementById('printPreviewContent').innerHTML = printContent;
            
            // Update print date
            const today = new Date();
            const dateStr = today.toLocaleDateString();
            document.getElementById('printDate').textContent = `Generated on: ${dateStr}`;
            
            // Show print preview modal
            const modal = new bootstrap.Modal(document.getElementById('printPreviewModal'));
            modal.show();
        }
        
        // Populate position filter dropdown
        function populatePositionFilter() {
            const positions = [...new Set(employees.map(emp => emp.position))];
            const filterPosition = document.getElementById('filterPosition');
            
            // Clear existing options except the first one
            while (filterPosition.options.length > 1) {
                filterPosition.remove(1);
            }
            
            // Add positions
            positions.forEach(position => {
                const option = document.createElement('option');
                option.value = position;
                option.textContent = position;
                filterPosition.appendChild(option);
            });
        }
        
        // Sort table
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            renderEmployeeTable();
        }
        
        // Render employee table
        function renderEmployeeTable(filteredEmployees = null) {
            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = '';
            
            let employeesToShow = filteredEmployees || employees;
            
            // If not admin, filter by department
            if (currentUser.role !== 'admin') {
                employeesToShow = employeesToShow.filter(emp => emp.department === currentUser.department);
            }
            
            if (employeesToShow.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="8" class="text-center">No employees found</td>';
                tbody.appendChild(row);
                return;
            }
            
            // Sort employees
            employeesToShow.sort((a, b) => {
                let valueA, valueB;
                
                switch (sortColumn) {
                    case 'id':
                        valueA = a.id;
                        valueB = b.id;
                        break;
                    case 'name':
                        valueA = a.name;
                        valueB = b.name;
                        break;
                    case 'position':
                        valueA = a.position;
                        valueB = b.position;
                        break;
                    case 'department':
                        valueA = a.department;
                        valueB = b.department;
                        break;
                    case 'overallRating':
                        valueA = calculateOverallRating(a);
                        valueB = calculateOverallRating(b);
                        break;
                    default:
                        return 0;
                }
                
                if (typeof valueA === 'string') {
                    return sortDirection === 'asc' 
                        ? valueA.localeCompare(valueB)
                        : valueB.localeCompare(valueA);
                } else {
                    return sortDirection === 'asc' 
                        ? valueA - valueB
                        : valueB - valueA;
                }
            });
            
            employeesToShow.forEach(employee => {
                const row = document.createElement('tr');
                
                // Calculate overall rating
                const overallRating = calculateOverallRating(employee);
                
                // Get rating class for styling
                const ratingClass = getRatingClass(overallRating);
                
                // Format daily and other work for display
                let dailyWorkDisplay = '';
                let otherWorkDisplay = '';
                
                // Different display based on department type
                if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                    const technicalWorkCount = employee.technicalWork ? employee.technicalWork.length : 0;
                    dailyWorkDisplay = 'N/A';
                    otherWorkDisplay = `${technicalWorkCount} work records`;
                } else {
                    const dailyWorkCount = employee.dailyWork ? employee.dailyWork.length : 0;
                    const otherWorkCount = employee.otherWork ? employee.otherWork.length : 0;
                    dailyWorkDisplay = dailyWorkCount > 0 ? `${dailyWorkCount} entries` : 'No entries';
                    otherWorkDisplay = otherWorkCount > 0 ? `${otherWorkCount} entries` : 'No entries';
                }
                
                // Format department name for display
                let departmentDisplay = employee.department;
                if (employee.department === 'crushing-prep') {
                    departmentDisplay = 'Crushing & Preparation';
                } else if (employee.department === 'cutting-setting') {
                    departmentDisplay = 'Cutting & Setting';
                }
                
                row.innerHTML = `
                    <td>${employee.id}</td>
                    <td>${employee.name}</td>
                    <td>${employee.position}</td>
                    <td>${departmentDisplay}</td>
                    <td><span class="badge rating-badge ${ratingClass}">${overallRating.toFixed(1)}</span></td>
                    <td>${dailyWorkDisplay}</td>
                    <td>${otherWorkDisplay}</td>
                    <td>
                        <button class="btn btn-sm btn-primary view-employee-btn" data-id="${employee.id}">
                            <i class="bi bi-eye"></i> View
                        </button>
                        <button class="btn btn-sm btn-info work-records-btn ms-1" data-id="${employee.id}">
                            <i class="bi bi-clipboard-data"></i> Records
                        </button>
                        ${currentUser.role === 'admin' ? `
                        <button class="btn btn-sm btn-warning edit-employee-btn ms-1" data-id="${employee.id}">
                            <i class="bi bi-pencil"></i> Edit
                        </button>` : ''}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners to view/edit buttons
            document.querySelectorAll('.view-employee-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    viewEmployee(this.dataset.id);
                });
            });
            
            document.querySelectorAll('.edit-employee-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    editEmployee(this.dataset.id);
                });
            });
            
            document.querySelectorAll('.work-records-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    viewWorkRecords(this.dataset.id);
                });
            });
        }
        
        // Calculate overall rating
        function calculateOverallRating(employee) {
            let totalRating = 0;
            let count = 0;
            
            // Different calculation based on department type
            if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                // For technical departments, calculate from technical work
                if (employee.technicalWork && employee.technicalWork.length > 0) {
                    totalRating = employee.technicalWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                    count = employee.technicalWork.length;
                }
            } else {
                // For production departments, calculate from daily and other work
                // Calculate daily work average
                if (employee.dailyWork && employee.dailyWork.length > 0) {
                    const dailySum = employee.dailyWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                    totalRating += dailySum / employee.dailyWork.length;
                    count++;
                }
                
                // Calculate other work average
                if (employee.otherWork && employee.otherWork.length > 0) {
                    const otherSum = employee.otherWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                    totalRating += otherSum / employee.otherWork.length;
                    count++;
                }
            }
            
            // Return average or 0 if no ratings
            return count > 0 ? totalRating / count : 0;
        }
        
        // Get rating class for styling
        function getRatingClass(rating) {
            if (rating >= 50) return 'rating-excellent';
            if (rating >= 20) return 'rating-good';
            if (rating >= -20) return 'rating-average';
            return 'rating-poor';
        }
        
        // Get rating class for work records
        function getWorkRecordClass(rating) {
            if (rating >= 50) return 'rating-positive';
            if (rating >= -50) return 'rating-neutral';
            return 'rating-negative';
        }
        
        // Apply filters
        function applyFilters() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchId = document.getElementById('searchId').value.toLowerCase();
            const filterPosition = document.getElementById('filterPosition').value;
            const filterDepartment = document.getElementById('filterDepartment').value;
            
            let filteredEmployees = employees;
            
            // Filter by name
            if (searchName) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.name.toLowerCase().includes(searchName)
                );
            }
            
            // Filter by ID
            if (searchId) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.id.toLowerCase().includes(searchId)
                );
            }
            
            // Filter by position
            if (filterPosition) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.position === filterPosition
                );
            }
            
            // Filter by department
            if (filterDepartment) {
                filteredEmployees = filteredEmployees.filter(emp => 
                    emp.department === filterDepartment
                );
            }
            
            renderEmployeeTable(filteredEmployees);
        }
        
        // Reset filters
        function resetFilters() {
            document.getElementById('searchName').value = '';
            document.getElementById('searchId').value = '';
            document.getElementById('filterPosition').value = '';
            document.getElementById('filterDepartment').value = '';
            
            renderEmployeeTable();
        }
        
        // Open add employee modal
        function openAddEmployeeModal() {
            editingEmployeeId = null;
            
            // Reset form
            document.getElementById('employeeForm').reset();
            document.getElementById('dailyWorkContainer').innerHTML = '';
            document.getElementById('otherWorkContainer').innerHTML = '';
            document.getElementById('technicalWorkContainer').innerHTML = '';
            
            // Update modal title
            document.getElementById('employeeModalLabel').textContent = 'Add New Employee';
            
            // Hide delete button
            document.getElementById('deleteEmployeeBtn').style.display = 'none';
            
            // Enable all fields
            enableFormFields(true);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('employeeModal'));
            modal.show();
        }
        
        // View employee
        function viewEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            editingEmployeeId = id;
            
            // Fill form with employee data
            document.getElementById('employeeId').value = employee.id;
            document.getElementById('employeeIdInput').value = employee.id;
            document.getElementById('employeeName').value = employee.name;
            document.getElementById('employeePosition').value = employee.position;
            document.getElementById('employeeDepartment').value = employee.department;
            
            // Load work entries based on department type
            if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                loadTechnicalWorkEntries(employee);
            } else {
                loadWorkEntries(employee);
            }
            
            // Update modal title
            document.getElementById('employeeModalLabel').textContent = `Employee Details: ${employee.name}`;
            
            // Disable form fields if not admin
            const isEditable = currentUser.role === 'admin';
            enableFormFields(isEditable);
            
            // Show/hide delete button
            document.getElementById('deleteEmployeeBtn').style.display = currentUser.role === 'admin' ? 'block' : 'none';
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('employeeModal'));
            modal.show();
        }
        
        // Edit employee
        function editEmployee(id) {
            viewEmployee(id);
            
            // Switch to details tab
            const detailsTab = document.getElementById('details-tab');
            const tab = new bootstrap.Tab(detailsTab);
            tab.show();
        }
        
        // View work records
        function viewWorkRecords(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            currentEmployeeId = id;
            
            // Update employee name in header
            document.getElementById('currentEmployeeName').textContent = employee.name;
            
            // Show/hide add record button based on user role
            const canAddRecords = currentUser.role === 'admin' || 
                                 (currentUser.role === 'supervisor' && currentUser.department === employee.department);
            
            document.getElementById('addRecordBtn').style.display = canAddRecords ? 'block' : 'none';
            document.getElementById('floatingAddBtn').style.display = canAddRecords ? 'block' : 'none';
            
            // Different handling based on department type
            if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                // Show technical work page
                document.getElementById('dashboardPage').style.display = 'none';
                document.getElementById('workRecordsPage').style.display = 'none';
                document.getElementById('technicalWorkPage').style.display = 'block';
                
                document.getElementById('addTechnicalRecordBtn').style.display = canAddRecords ? 'block' : 'none';
                document.getElementById('floatingTechnicalAddBtn').style.display = canAddRecords ? 'block' : 'none';
                
                // Update employee name in header
                document.getElementById('currentTechnicalEmployeeName').textContent = employee.name;
                
                // Load technical work records
                loadTechnicalWorkRecords(employee);
            } else {
                // Show production work page
                document.getElementById('dashboardPage').style.display = 'none';
                document.getElementById('workRecordsPage').style.display = 'block';
                document.getElementById('technicalWorkPage').style.display = 'none';
                
                // Set initial record type to daily
                currentRecordType = 'daily';
                updateRecordTabs();
                
                // Load work records
                loadWorkRecords(employee);
            }
        }
        
        // Back to dashboard
        function backToDashboard() {
            document.getElementById('workRecordsPage').style.display = 'none';
            document.getElementById('technicalWorkPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'block';
        }
        
        // Switch record type
        function switchRecordType(type) {
            currentRecordType = type;
            updateRecordTabs();
            loadWorkRecords();
        }
        
        // Update record tabs
        function updateRecordTabs() {
            const dailyTab = document.getElementById('dailyWorkTab');
            const otherTab = document.getElementById('otherWorkTab');
            const recordsTitle = document.getElementById('recordsTitle');
            
            if (currentRecordType === 'daily') {
                dailyTab.classList.add('active');
                otherTab.classList.remove('active');
                recordsTitle.textContent = 'Daily Work Records';
            } else {
                dailyTab.classList.remove('active');
                otherTab.classList.add('active');
                recordsTitle.textContent = 'Other Work Records';
            }
        }
        
        // Load work records
        function loadWorkRecords(employee = null) {
            if (!employee) {
                employee = employees.find(emp => emp.id === currentEmployeeId);
                if (!employee) return;
            }
            
            const recordsContainer = document.getElementById('recordsContainer');
            recordsContainer.innerHTML = '';
            
            // Update record counts
            const dailyCount = employee.dailyWork ? employee.dailyWork.length : 0;
            const otherCount = employee.otherWork ? employee.otherWork.length : 0;
            
            document.getElementById('dailyWorkCount').textContent = dailyCount;
            document.getElementById('otherWorkCount').textContent = otherCount;
            
            // Load records based on current type
            if (currentRecordType === 'daily') {
                if (employee.dailyWork && employee.dailyWork.length > 0) {
                    employee.dailyWork.forEach((work, index) => {
                        const recordDiv = document.createElement('div');
                        recordDiv.className = 'work-record-card';
                        
                        const ratingClass = getWorkRecordClass(parseInt(work.rate));
                        
                        recordDiv.innerHTML = `
                            <div class="work-record-header">
                                <div class="work-record-title">Daily Work - ${work.carts} Carts</div>
                                <div class="work-record-date">${work.date || 'No date'}</div>
                            </div>
                            <div class="work-record-rating ${ratingClass}">Rating: ${work.rate}</div>
                            <div class="work-record-note">${work.note || 'No note'}</div>
                            ${currentUser.role === 'admin' ? `
                            <div class="mt-2">
                                <button class="btn btn-sm btn-warning edit-daily-work-btn" data-index="${index}">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger delete-daily-work-btn" data-index="${index}">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </div>` : ''}
                        `;
                        
                        recordsContainer.appendChild(recordDiv);
                    });
                } else {
                    recordsContainer.innerHTML = '<p class="text-muted">No daily work records found</p>';
                }
            } else {
                if (employee.otherWork && employee.otherWork.length > 0) {
                    employee.otherWork.forEach((work, index) => {
                        const recordDiv = document.createElement('div');
                        recordDiv.className = 'work-record-card';
                        
                        const ratingClass = getWorkRecordClass(parseInt(work.rate));
                        
                        recordDiv.innerHTML = `
                            <div class="work-record-header">
                                <div class="work-record-title">${work.name}</div>
                                <div class="work-record-date">${work.date || 'No date'}</div>
                            </div>
                            <div class="work-record-rating ${ratingClass}">Rating: ${work.rate}</div>
                            <div class="work-record-note">${work.note || 'No note'}</div>
                            ${currentUser.role === 'admin' ? `
                            <div class="mt-2">
                                <button class="btn btn-sm btn-warning edit-other-work-btn" data-index="${index}">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger delete-other-work-btn" data-index="${index}">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </div>` : ''}
                        `;
                        
                        recordsContainer.appendChild(recordDiv);
                    });
                } else {
                    recordsContainer.innerHTML = '<p class="text-muted">No other work records found</p>';
                }
            }
            
            // Add event listeners for edit/delete buttons
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.edit-daily-work-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        editDailyWorkRecord(this.dataset.index);
                    });
                });
                
                document.querySelectorAll('.delete-daily-work-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        deleteDailyWorkRecord(this.dataset.index);
                    });
                });
                
                document.querySelectorAll('.edit-other-work-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        editOtherWorkRecord(this.dataset.index);
                    });
                });
                
                document.querySelectorAll('.delete-other-work-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        deleteOtherWorkRecord(this.dataset.index);
                    });
                });
            }
        }
        
        // Load technical work records
        function loadTechnicalWorkRecords(employee = null) {
            if (!employee) {
                employee = employees.find(emp => emp.id === currentEmployeeId);
                if (!employee) return;
            }
            
            const recordsContainer = document.getElementById('technicalRecordsContainer');
            recordsContainer.innerHTML = '';
            
            // Update record count
            const technicalCount = employee.technicalWork ? employee.technicalWork.length : 0;
            
            // Load records
            if (employee.technicalWork && employee.technicalWork.length > 0) {
                employee.technicalWork.forEach((work, index) => {
                    const recordDiv = document.createElement('div');
                    recordDiv.className = 'work-record-card';
                    
                    const ratingClass = getWorkRecordClass(parseInt(work.rate));
                    
                    recordDiv.innerHTML = `
                        <div class="work-record-header">
                            <div class="work-record-title">${work.description}</div>
                            <div class="work-record-date">${work.date || 'No date'}</div>
                        </div>
                        <div class="work-record-rating ${ratingClass}">Rating: ${work.rate}</div>
                        <div class="work-record-note">Hours: ${work.hours}</div>
                        <div class="work-record-note">${work.note || 'No note'}</div>
                        ${currentUser.role === 'admin' ? `
                        <div class="mt-2">
                            <button class="btn btn-sm btn-warning edit-technical-work-btn" data-index="${index}">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger delete-technical-work-btn" data-index="${index}">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>` : ''}
                    `;
                    
                    recordsContainer.appendChild(recordDiv);
                });
            } else {
                recordsContainer.innerHTML = '<p class="text-muted">No work records found</p>';
            }
            
            // Add event listeners for edit/delete buttons
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.edit-technical-work-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        editTechnicalWorkRecord(this.dataset.index);
                    });
                });
                
                document.querySelectorAll('.delete-technical-work-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        deleteTechnicalWorkRecord(this.dataset.index);
                    });
                });
            }
        }
        
        // Open add daily work modal
        function openAddDailyWorkModal(editIndex = null) {
            // Reset form
            document.getElementById('dailyWorkForm').reset();
            document.getElementById('dailyWorkRatingValue').textContent = '0';
            
            // Set today's date as default
            document.getElementById('dailyWorkDate').valueAsDate = new Date();
            
            // Store edit index if editing
            document.getElementById('dailyWorkForm').dataset.editIndex = editIndex || '';
            
            // If editing, populate form
            if (editIndex !== null) {
                const employee = employees.find(emp => emp.id === currentEmployeeId);
                if (employee && employee.dailyWork && employee.dailyWork[editIndex]) {
                    const work = employee.dailyWork[editIndex];
                    document.getElementById('dailyWorkDate').value = work.date || '';
                    document.getElementById('dailyWorkCarts').value = work.carts || '';
                    document.getElementById('dailyWorkRating').value = work.rate || 0;
                    document.getElementById('dailyWorkRatingValue').textContent = work.rate || 0;
                    document.getElementById('dailyWorkNote').value = work.note || '';
                }
            }
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addDailyWorkModal'));
            modal.show();
        }
        
        // Open add other work modal
        function openAddOtherWorkModal(editIndex = null) {
            // Reset form
            document.getElementById('otherWorkForm').reset();
            document.getElementById('otherWorkRatingValue').textContent = '0';
            
            // Set today's date as default
            document.getElementById('otherWorkDate').valueAsDate = new Date();
            
            // Store edit index if editing
            document.getElementById('otherWorkForm').dataset.editIndex = editIndex || '';
            
            // If editing, populate form
            if (editIndex !== null) {
                const employee = employees.find(emp => emp.id === currentEmployeeId);
                if (employee && employee.otherWork && employee.otherWork[editIndex]) {
                    const work = employee.otherWork[editIndex];
                    document.getElementById('otherWorkDate').value = work.date || '';
                    document.getElementById('otherWorkName').value = work.name || '';
                    document.getElementById('otherWorkRating').value = work.rate || 0;
                    document.getElementById('otherWorkRatingValue').textContent = work.rate || 0;
                    document.getElementById('otherWorkNote').value = work.note || '';
                }
            }
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addOtherWorkModal'));
            modal.show();
        }
        
        // Open add technical work modal
        function openAddTechnicalWorkModal(editIndex = null) {
            // Reset form
            document.getElementById('technicalWorkForm').reset();
            document.getElementById('technicalWorkRatingValue').textContent = '0';
            
            // Set today's date as default
            document.getElementById('technicalWorkDate').valueAsDate = new Date();
            
            // Store edit index if editing
            document.getElementById('technicalWorkForm').dataset.editIndex = editIndex || '';
            
            // If editing, populate form
            if (editIndex !== null) {
                const employee = employees.find(emp => emp.id === currentEmployeeId);
                if (employee && employee.technicalWork && employee.technicalWork[editIndex]) {
                    const work = employee.technicalWork[editIndex];
                    document.getElementById('technicalWorkDate').value = work.date || '';
                    document.getElementById('technicalWorkDescription').value = work.description || '';
                    document.getElementById('technicalWorkHours').value = work.hours || '';
                    document.getElementById('technicalWorkRating').value = work.rate || 0;
                    document.getElementById('technicalWorkRatingValue').textContent = work.rate || 0;
                    document.getElementById('technicalWorkNote').value = work.note || '';
                }
            }
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addTechnicalWorkModal'));
            modal.show();
        }
        
        // Save daily work record
        function saveDailyWorkRecord() {
            const date = document.getElementById('dailyWorkDate').value;
            const carts = document.getElementById('dailyWorkCarts').value;
            const rate = document.getElementById('dailyWorkRating').value;
            const note = document.getElementById('dailyWorkNote').value;
            const editIndex = document.getElementById('dailyWorkForm').dataset.editIndex;
            
            // Validate form
            if (!date || !carts) {
                showNotification('Please fill in all required fields', 'danger');
                return;
            }
            
            // Find employee
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;
            
            // Initialize dailyWork array if it doesn't exist
            if (!employee.dailyWork) {
                employee.dailyWork = [];
            }
            
            // Create work record
            const workRecord = {
                date,
                carts,
                rate,
                note
            };
            
            // Add or update record
            if (editIndex !== '') {
                employee.dailyWork[editIndex] = workRecord;
            } else {
                employee.dailyWork.push(workRecord);
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Reload work records
            loadWorkRecords(employee);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addDailyWorkModal'));
            modal.hide();
            
            // Show notification
            showNotification(editIndex !== '' ? 'Daily work record updated' : 'Daily work record added', 'success');
        }
        
        // Save other work record
        function saveOtherWorkRecord() {
            const date = document.getElementById('otherWorkDate').value;
            const name = document.getElementById('otherWorkName').value;
            const rate = document.getElementById('otherWorkRating').value;
            const note = document.getElementById('otherWorkNote').value;
            const editIndex = document.getElementById('otherWorkForm').dataset.editIndex;
            
            // Validate form
            if (!date || !name) {
                showNotification('Please fill in all required fields', 'danger');
                return;
            }
            
            // Find employee
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;
            
            // Initialize otherWork array if it doesn't exist
            if (!employee.otherWork) {
                employee.otherWork = [];
            }
            
            // Create work record
            const workRecord = {
                date,
                name,
                rate,
                note
            };
            
            // Add or update record
            if (editIndex !== '') {
                employee.otherWork[editIndex] = workRecord;
            } else {
                employee.otherWork.push(workRecord);
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Reload work records
            loadWorkRecords(employee);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addOtherWorkModal'));
            modal.hide();
            
            // Show notification
            showNotification(editIndex !== '' ? 'Other work record updated' : 'Other work record added', 'success');
        }
        
        // Save technical work record
        function saveTechnicalWorkRecord() {
            const date = document.getElementById('technicalWorkDate').value;
            const description = document.getElementById('technicalWorkDescription').value;
            const hours = document.getElementById('technicalWorkHours').value;
            const rate = document.getElementById('technicalWorkRating').value;
            const note = document.getElementById('technicalWorkNote').value;
            const editIndex = document.getElementById('technicalWorkForm').dataset.editIndex;
            
            // Validate form
            if (!date || !description || !hours) {
                showNotification('Please fill in all required fields', 'danger');
                return;
            }
            
            // Find employee
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;
            
            // Initialize technicalWork array if it doesn't exist
            if (!employee.technicalWork) {
                employee.technicalWork = [];
            }
            
            // Create work record
            const workRecord = {
                date,
                description,
                hours,
                rate,
                note
            };
            
            // Add or update record
            if (editIndex !== '') {
                employee.technicalWork[editIndex] = workRecord;
            } else {
                employee.technicalWork.push(workRecord);
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Reload work records
            loadTechnicalWorkRecords(employee);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addTechnicalWorkModal'));
            modal.hide();
            
            // Show notification
            showNotification(editIndex !== '' ? 'Work record updated' : 'Work record added', 'success');
        }
        
        // Edit daily work record
        function editDailyWorkRecord(index) {
            openAddDailyWorkModal(index);
        }
        
        // Edit other work record
        function editOtherWorkRecord(index) {
            openAddOtherWorkModal(index);
        }
        
        // Edit technical work record
        function editTechnicalWorkRecord(index) {
            openAddTechnicalWorkModal(index);
        }
        
        // Delete daily work record
        function deleteDailyWorkRecord(index) {
            if (!confirm('Are you sure you want to delete this daily work record?')) return;
            
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee || !employee.dailyWork) return;
            
            employee.dailyWork.splice(index, 1);
            
            // Save to localStorage
            saveDataToStorage();
            
            // Reload work records
            loadWorkRecords(employee);
            
            // Show notification
            showNotification('Daily work record deleted', 'success');
        }
        
        // Delete other work record
        function deleteOtherWorkRecord(index) {
            if (!confirm('Are you sure you want to delete this other work record?')) return;
            
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee || !employee.otherWork) return;
            
            employee.otherWork.splice(index, 1);
            
            // Save to localStorage
            saveDataToStorage();
            
            // Reload work records
            loadWorkRecords(employee);
            
            // Show notification
            showNotification('Other work record deleted', 'success');
        }
        
        // Delete technical work record
        function deleteTechnicalWorkRecord(index) {
            if (!confirm('Are you sure you want to delete this work record?')) return;
            
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee || !employee.technicalWork) return;
            
            employee.technicalWork.splice(index, 1);
            
            // Save to localStorage
            saveDataToStorage();
            
            // Reload work records
            loadTechnicalWorkRecords(employee);
            
            // Show notification
            showNotification('Work record deleted', 'success');
        }
        
        // Load work entries
        function loadWorkEntries(employee) {
            // Clear containers
            document.getElementById('dailyWorkContainer').innerHTML = '';
            document.getElementById('otherWorkContainer').innerHTML = '';
            
            // Load daily work entries
            if (employee.dailyWork && employee.dailyWork.length > 0) {
                employee.dailyWork.forEach((work, index) => {
                    addDailyWorkEntry(work);
                });
            } else {
                addDailyWorkEntry();
            }
            
            // Load other work entries
            if (employee.otherWork && employee.otherWork.length > 0) {
                employee.otherWork.forEach((work, index) => {
                    addOtherWorkEntry(work);
                });
            } else {
                addOtherWorkEntry();
            }
            
            // Update overall rating display
            updateOverallRatingDisplay(employee);
        }
        
        // Load technical work entries
        function loadTechnicalWorkEntries(employee) {
            // Clear container
            document.getElementById('technicalWorkContainer').innerHTML = '';
            
            // Load technical work entries
            if (employee.technicalWork && employee.technicalWork.length > 0) {
                employee.technicalWork.forEach((work, index) => {
                    addTechnicalWorkEntry(work);
                });
            } else {
                addTechnicalWorkEntry();
            }
            
            // Update overall rating display
            updateOverallRatingDisplay(employee);
        }
        
        // Add daily work entry
        function addDailyWorkEntry(data = null) {
            const container = document.getElementById('dailyWorkContainer');
            const entryDiv = document.createElement('div');
            entryDiv.className = 'work-entry';
            
            const date = data ? data.date || '' : '';
            const carts = data ? data.carts || '' : '';
            const rate = data ? data.rate || '0' : '0';
            const note = data ? data.note || '' : '';
            
            entryDiv.innerHTML = `
                <div class="row g-2">
                    <div class="col-md-2">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-control date-input" value="${date}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Carts</label>
                        <input type="number" class="form-control carts-input" min="1" value="${carts}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Rating (-100 to 100)</label>
                        <input type="range" class="form-range rate-input" min="-100" max="100" value="${rate}">
                        <div class="d-flex justify-content-between">
                            <span>-100</span>
                            <span class="rate-value">${rate}</span>
                            <span>100</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Note</label>
                        <input type="text" class="form-control note-input" value="${note}">
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button class="btn btn-sm btn-danger remove-entry-btn">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            container.appendChild(entryDiv);
            
            // Add event listener to remove button
            entryDiv.querySelector('.remove-entry-btn').addEventListener('click', function() {
                entryDiv.remove();
                updateOverallRatingDisplay();
            });
            
            // Add event listener to rate input
            const rateInput = entryDiv.querySelector('.rate-input');
            const rateValue = entryDiv.querySelector('.rate-value');
            
            rateInput.addEventListener('input', function() {
                rateValue.textContent = this.value;
                updateOverallRatingDisplay();
            });
        }
        
        // Add other work entry
        function addOtherWorkEntry(data = null) {
            const container = document.getElementById('otherWorkContainer');
            const entryDiv = document.createElement('div');
            entryDiv.className = 'work-entry';
            
            const date = data ? data.date || '' : '';
            const name = data ? data.name || '' : '';
            const rate = data ? data.rate || '0' : '0';
            const note = data ? data.note || '' : '';
            
            entryDiv.innerHTML = `
                <div class="row g-2">
                    <div class="col-md-2">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-control date-input" value="${date}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Name of Work</label>
                        <input type="text" class="form-control name-input" value="${name}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Rating (-100 to 100)</label>
                        <input type="range" class="form-range rate-input" min="-100" max="100" value="${rate}">
                        <div class="d-flex justify-content-between">
                            <span>-100</span>
                            <span class="rate-value">${rate}</span>
                            <span>100</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Note</label>
                        <input type="text" class="form-control note-input" value="${note}">
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button class="btn btn-sm btn-danger remove-entry-btn">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            container.appendChild(entryDiv);
            
            // Add event listener to remove button
            entryDiv.querySelector('.remove-entry-btn').addEventListener('click', function() {
                entryDiv.remove();
                updateOverallRatingDisplay();
            });
            
            // Add event listener to rate input
            const rateInput = entryDiv.querySelector('.rate-input');
            const rateValue = entryDiv.querySelector('.rate-value');
            
            rateInput.addEventListener('input', function() {
                rateValue.textContent = this.value;
                updateOverallRatingDisplay();
            });
        }
        
        // Add technical work entry
        function addTechnicalWorkEntry(data = null) {
            const container = document.getElementById('technicalWorkContainer');
            const entryDiv = document.createElement('div');
            entryDiv.className = 'technical-entry';
            
            const date = data ? data.date || '' : '';
            const description = data ? data.description || '' : '';
            const hours = data ? data.hours || '' : '';
            const rate = data ? data.rate || '0' : '0';
            const note = data ? data.note || '' : '';
            
            entryDiv.innerHTML = `
                <div class="row g-2">
                    <div class="col-md-2">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-control date-input" value="${date}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Work Description</label>
                        <input type="text" class="form-control description-input" value="${description}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Hours</label>
                        <input type="number" class="form-control hours-input" min="0.5" step="0.5" value="${hours}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Rating (-100 to 100)</label>
                        <input type="range" class="form-range rate-input" min="-100" max="100" value="${rate}">
                        <div class="d-flex justify-content-between">
                            <span>-100</span>
                            <span class="rate-value">${rate}</span>
                            <span>100</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Note</label>
                        <input type="text" class="form-control note-input" value="${note}">
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button class="btn btn-sm btn-danger remove-entry-btn">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            container.appendChild(entryDiv);
            
            // Add event listener to remove button
            entryDiv.querySelector('.remove-entry-btn').addEventListener('click', function() {
                entryDiv.remove();
                updateOverallRatingDisplay();
            });
            
            // Add event listener to rate input
            const rateInput = entryDiv.querySelector('.rate-input');
            const rateValue = entryDiv.querySelector('.rate-value');
            
            rateInput.addEventListener('input', function() {
                rateValue.textContent = this.value;
                updateOverallRatingDisplay();
            });
        }
        
        // Update overall rating display
        function updateOverallRatingDisplay(employee = null) {
            let totalRating = 0;
            let count = 0;
            
            // Calculate from form if no employee provided
            if (!employee) {
                // Different calculation based on department type
                const department = document.getElementById('employeeDepartment').value;
                
                if (department === 'mechanical' || department === 'electrical-ac') {
                    // For technical departments, calculate from technical work entries
                    document.querySelectorAll('#technicalWorkContainer .technical-entry').forEach(entry => {
                        const rate = parseInt(entry.querySelector('.rate-input').value) || 0;
                        totalRating += rate;
                        count++;
                    });
                } else {
                    // For production departments, calculate from daily and other work entries
                    // Get daily work values
                    document.querySelectorAll('#dailyWorkContainer .work-entry').forEach(entry => {
                        const rate = parseInt(entry.querySelector('.rate-input').value) || 0;
                        totalRating += rate;
                        count++;
                    });
                    
                    // Get other work values
                    document.querySelectorAll('#otherWorkContainer .work-entry').forEach(entry => {
                        const rate = parseInt(entry.querySelector('.rate-input').value) || 0;
                        totalRating += rate;
                        count++;
                    });
                }
            } else {
                // Calculate from employee data
                if (employee.department === 'mechanical' || employee.department === 'electrical-ac') {
                    // For technical departments, calculate from technical work
                    if (employee.technicalWork && employee.technicalWork.length > 0) {
                        totalRating = employee.technicalWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                        count = employee.technicalWork.length;
                    }
                } else {
                    // For production departments, calculate from daily and other work
                    // Calculate daily work average
                    if (employee.dailyWork && employee.dailyWork.length > 0) {
                        const dailySum = employee.dailyWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                        totalRating += dailySum / employee.dailyWork.length;
                        count++;
                    }
                    
                    // Calculate other work average
                    if (employee.otherWork && employee.otherWork.length > 0) {
                        const otherSum = employee.otherWork.reduce((sum, work) => sum + parseInt(work.rate), 0);
                        totalRating += otherSum / employee.otherWork.length;
                        count++;
                    }
                }
            }
            
            // Calculate overall rating
            let overallRating = 0;
            if (count > 0) {
                overallRating = totalRating / count;
            }
            
            // Update display
            document.getElementById('overallRatingDisplay').textContent = overallRating.toFixed(1);
            
            // Calculate percentage for progress bar (map -100 to 100 to 0 to 100)
            const percentage = ((overallRating + 100) / 200) * 100;
            const ratingBar = document.getElementById('overallRatingBar');
            ratingBar.style.width = `${percentage}%`;
            ratingBar.setAttribute('aria-valuenow', overallRating);
            ratingBar.textContent = `${percentage.toFixed(0)}%`;
            
            // Update color based on rating
            ratingBar.className = 'progress-bar';
            if (overallRating >= 50) {
                ratingBar.classList.add('bg-success');
            } else if (overallRating >= 20) {
                ratingBar.classList.add('bg-info');
            } else if (overallRating >= -20) {
                ratingBar.classList.add('bg-warning');
            } else {
                ratingBar.classList.add('bg-danger');
            }
        }
        
        // Enable/disable form fields
        function enableFormFields(enable) {
            const formFields = document.querySelectorAll('#employeeForm input, #employeeForm select');
            formFields.forEach(field => {
                field.disabled = !enable;
            });
        }
        
        // Save employee
        function saveEmployee() {
            const id = document.getElementById('employeeId').value;
            const employeeIdInput = document.getElementById('employeeIdInput').value;
            const name = document.getElementById('employeeName').value;
            const position = document.getElementById('employeePosition').value;
            const department = document.getElementById('employeeDepartment').value;
            
            // Validate form
            if (!employeeIdInput || !name || !position || !department) {
                showNotification('Please fill in all required fields', 'danger');
                return;
            }
            
            // Different handling based on department type
            let newEmployee;
            
            if (department === 'mechanical' || department === 'electrical-ac') {
                // For technical departments
                const technicalWork = [];
                document.querySelectorAll('#technicalWorkContainer .technical-entry').forEach(entry => {
                    const date = entry.querySelector('.date-input').value;
                    const description = entry.querySelector('.description-input').value;
                    const hours = entry.querySelector('.hours-input').value;
                    const rate = entry.querySelector('.rate-input').value;
                    const note = entry.querySelector('.note-input').value;
                    
                    if (date && description && hours) {
                        technicalWork.push({ date, description, hours, rate, note });
                    }
                });
                
                newEmployee = {
                    id: employeeIdInput,
                    name,
                    position,
                    department,
                    technicalWork
                };
            } else {
                // For production departments
                // Collect daily work entries
                const dailyWork = [];
                document.querySelectorAll('#dailyWorkContainer .work-entry').forEach(entry => {
                    const date = entry.querySelector('.date-input').value;
                    const carts = entry.querySelector('.carts-input').value;
                    const rate = entry.querySelector('.rate-input').value;
                    const note = entry.querySelector('.note-input').value;
                    
                    if (date && carts) {
                        dailyWork.push({ date, carts, rate, note });
                    }
                });
                
                // Collect other work entries
                const otherWork = [];
                document.querySelectorAll('#otherWorkContainer .work-entry').forEach(entry => {
                    const date = entry.querySelector('.date-input').value;
                    const name = entry.querySelector('.name-input').value;
                    const rate = entry.querySelector('.rate-input').value;
                    const note = entry.querySelector('.note-input').value;
                    
                    if (date && name) {
                        otherWork.push({ date, name, rate, note });
                    }
                });
                
                newEmployee = {
                    id: employeeIdInput,
                    name,
                    position,
                    department,
                    dailyWork,
                    otherWork
                };
            }
            
            // Check if editing existing employee or adding new one
            if (editingEmployeeId) {
                // Update existing employee
                const index = employees.findIndex(emp => emp.id === editingEmployeeId);
                if (index !== -1) {
                    employees[index] = newEmployee;
                }
            } else {
                // Add new employee
                employees.push(newEmployee);
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Update table
            renderEmployeeTable();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('employeeModal'));
            modal.hide();
            
            // Show notification
            showNotification(editingEmployeeId ? 'Employee updated successfully' : 'Employee added successfully', 'success');
        }
        
        // Delete employee
        function deleteEmployee() {
            if (!editingEmployeeId) return;
            
            if (confirm('Are you sure you want to delete this employee?')) {
                employees = employees.filter(emp => emp.id !== editingEmployeeId);
                
                // Save to localStorage
                saveDataToStorage();
                
                // Update table
                renderEmployeeTable();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('employeeModal'));
                modal.hide();
                
                // Show notification
                showNotification('Employee deleted successfully', 'success');
            }
        }
        
        // Show notification
        function showNotification(message, type) {
            const toast = document.getElementById('notificationToast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            
            // Set toast class based on type
            toast.className = 'toast';
            if (type === 'success') {
                toast.classList.add('bg-success', 'text-white');
            } else if (type === 'danger') {
                toast.classList.add('bg-danger', 'text-white');
            } else if (type === 'warning') {
                toast.classList.add('bg-warning', 'text-dark');
            }
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        // Save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem('employees', JSON.stringify(employees));
        }
        
        // Load data from localStorage
        function loadDataFromStorage() {
            const savedEmployees = localStorage.getItem('employees');
            if (savedEmployees) {
                employees = JSON.parse(savedEmployees);
            } else {
                // Initialize with sample data if no data exists
                initializeSampleData();
            }
        }
        
        // Initialize with sample data
        function initializeSampleData() {
            employees = [
                {
                    id: 'EMP001',
                    name: 'emp 1',
                    position: 'Worker',
                    department: 'crushing-prep',
                    dailyWork: [
                        { date: '2023-01-01', carts: '10', rate: '75', note: 'Good performance' },
                        { date: '2023-01-02', carts: '12', rate: '85', note: 'Excellent work' }
                    ],
                    otherWork: [
                        { date: '2023-01-01', name: 'Machine Maintenance', rate: '65', note: 'Needs improvement' },
                        { date: '2023-01-03', name: 'Safety Protocol', rate: '95', note: 'Perfect execution' }
                    ]
                },
                {
                    id: 'EMP002',
                    name: 'emp 2',
                    position: 'Operator',
                    department: 'crushing-prep',
                    dailyWork: [
                        { date: '2023-01-01', carts: '15', rate: '80', note: 'Consistent performance' }
                    ],
                    otherWork: [
                        { date: '2023-01-02', name: 'Quality Control', rate: '70', note: 'Good attention to detail' }
                    ]
                },
                {
                    id: 'EMP003',
                    name: 'emp 3',
                    position: 'Technician',
                    department: 'cutting-setting',
                    dailyWork: [
                        { date: '2023-01-01', carts: '8', rate: '45', note: 'Average performance' }
                    ],
                    otherWork: [
                        { date: '2023-01-03', name: 'Equipment Setup', rate: '55', note: 'Good but could be faster' }
                    ]
                },
                {
                    id: 'EMP004',
                    name: 'emp 4',
                    position: 'Supervisor',
                    department: 'cutting-setting',
                    dailyWork: [
                        { date: '2023-01-01', carts: '18', rate: '95', note: 'Outstanding performance' },
                        { date: '2023-01-02', carts: '20', rate: '100', note: 'Exceeded expectations' }
                    ],
                    otherWork: [
                        { date: '2023-01-01', name: 'Team Management', rate: '85', note: 'Excellent leadership' },
                        { date: '2023-01-04', name: 'Process Optimization', rate: '75', note: 'Good improvements' }
                    ]
                },
                {
                    id: 'EMP005',
                    name: 'emp 5',
                    position: 'Worker',
                    department: 'klin',
                    dailyWork: [
                        { date: '2023-01-01', carts: '14', rate: '70', note: 'Reliable worker' }
                    ],
                    otherWork: [
                        { date: '2023-01-02', name: 'Temperature Monitoring', rate: '80', note: 'Very attentive' }
                    ]
                },
                {
                    id: 'EMP006',
                    name: 'emp 6',
                    position: 'Operator',
                    department: 'unsetting',
                    dailyWork: [
                        { date: '2023-01-01', carts: '11', rate: '60', note: 'Good work' }
                    ],
                    otherWork: [
                        { date: '2023-01-03', name: 'Safety Checks', rate: '70', note: 'Thorough inspections' }
                    ]
                },
                {
                    id: 'EMP007',
                    name: 'emp 7',
                    position: 'Mechanic',
                    department: 'mechanical',
                    technicalWork: [
                        { date: '2023-01-01', description: 'Engine Repair', hours: '4', rate: '75', note: 'Good work' },
                        { date: '2023-01-02', description: 'Hydraulic System Maintenance', hours: '6', rate: '85', note: 'Excellent work' },
                        { date: '2023-01-03', description: 'Conveyor Belt Adjustment', hours: '3', rate: '65', note: 'Needs improvement' }
                    ]
                },
                {
                    id: 'EMP008',
                    name: 'emp 8',
                    position: 'Electrician',
                    department: 'electrical-ac',
                    technicalWork: [
                        { date: '2023-01-01', description: 'AC Installation', hours: '5', rate: '80', note: 'Good work' },
                        { date: '2023-01-02', description: 'Electrical Panel Repair', hours: '3', rate: '90', note: 'Excellent work' },
                        { date: '2023-01-03', description: 'Lighting System Check', hours: '2', rate: '70', note: 'Good attention to detail' }
                    ]
                }
            ];
            
            saveDataToStorage();
        }

</script>

</body>
</html>
